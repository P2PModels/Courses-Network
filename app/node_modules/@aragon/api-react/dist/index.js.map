{"version":3,"sources":["../src/index.js"],"names":["warn","process","env","NODE_ENV","console","postMessage","name","value","window","parent","from","requestMenu","AragonApiContext","AragonApi","children","reducer","state","onMessage","api","setApi","appState","setAppState","connectedAccount","setConnectedAccount","currentApp","setCurrentApp","installedApps","setInstalledApps","appearance","theme","guiStyle","setGuiStyle","network","setNetwork","path","setPath","requestPath","setRequestPath","Aragon","providers","WindowMessage","toPromise","_mounted","Error","cancelled","subscribers","handleMessage","data","subscribe","accounts","apps","then","addEventListener","removeEventListener","forEach","subscriber","unsubscribe","Provider","displayMenuButton","getAragonApiData","hookName","aragonApiData","undefined","useAragonApi","_sendMessage","useApi","useAppState","useConnectedAccount","useCurrentApp","useInstalledApps","useNetwork","usePath","useGuiStyle","useMenuButton"],"mappings":"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","sourcesContent":["import {\n  createContext,\n  createElement,\n  useContext,\n  useEffect,\n  useState,\n} from 'react'\nimport Aragon, { providers } from '@aragon/api'\n\nconst warn = (...params) => {\n  // Warn in dev mode only\n  if (process.env.NODE_ENV === 'development') {\n    console.warn(...params)\n  }\n}\n\nconst postMessage = (name, value) => {\n  window.parent.postMessage({ from: 'app', name, value }, '*')\n}\n\nconst requestMenu = () => {\n  warn(\n    'api-react: \"requestMenu\" is deprecated and is a noop. It can safely be removed from your codebase.'\n  )\n}\n\nconst AragonApiContext = createContext()\n\nfunction AragonApi({\n  children,\n  reducer = state => (state === null ? {} : state),\n  onMessage = () => {},\n}) {\n  const [api, setApi] = useState(null)\n  const [appState, setAppState] = useState(null)\n  const [connectedAccount, setConnectedAccount] = useState('')\n  const [currentApp, setCurrentApp] = useState(null)\n  const [installedApps, setInstalledApps] = useState([])\n  const [guiStyle, setGuiStyle] = useState({ appearance: 'light', theme: null })\n  const [network, setNetwork] = useState(null)\n  const [path, setPath] = useState('/')\n  const [requestPath, setRequestPath] = useState(null)\n\n  useEffect(() => {\n    const api = new Aragon(new providers.WindowMessage(window.parent))\n    setApi(api)\n    setRequestPath(() => path => api.requestPath(path).toPromise())\n  }, [])\n\n  useEffect(() => {\n    if (AragonApi._mounted) {\n      throw new Error(\n        'AragonApi has been declared more than once. Please ensure ' +\n          'that you only have one instance in your application.'\n      )\n    }\n\n    AragonApi._mounted = true\n    return () => {\n      AragonApi._mounted = false\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!api) return\n\n    let cancelled = false\n    let subscribers = []\n\n    const handleMessage = ({ data } = {}) => {\n      if (!data || data.from !== 'wrapper') {\n        return\n      }\n\n      if (data.name === 'ready') {\n        subscribers = [\n          // app state\n          api.state().subscribe(state => setAppState(reducer(state))),\n\n          // account\n          api\n            .accounts()\n            .subscribe(accounts => setConnectedAccount(accounts[0] || '')),\n\n          // network\n          api.network().subscribe(network => setNetwork(network || null)),\n\n          // installed apps\n          api.installedApps().subscribe(apps => setInstalledApps(apps || [])),\n\n          // path\n          api.path().subscribe(path => setPath(path || '/')),\n\n          // GUI style\n          api.guiStyle().subscribe(setGuiStyle),\n        ]\n\n        api\n          .currentApp()\n          .toPromise()\n          .then(currentApp => {\n            if (!cancelled) {\n              setCurrentApp(currentApp || null)\n            }\n          })\n\n        postMessage('ready', true)\n      }\n\n      onMessage(data.name, data.value)\n    }\n\n    window.addEventListener('message', handleMessage)\n\n    return () => {\n      window.removeEventListener('message', handleMessage)\n      cancelled = true\n      subscribers.forEach(subscriber => subscriber.unsubscribe())\n    }\n  }, [api, reducer])\n\n  // We are only using createElement() once so letâ€™s use it directly rather\n  // than the JSX syntax, so we avoid adding a babel transform for it.\n  return createElement(\n    AragonApiContext.Provider,\n    {\n      value: {\n        api,\n        connectedAccount,\n        currentApp,\n        guiStyle,\n        installedApps,\n        network,\n        path,\n        requestPath,\n\n        // reducer(null) is called to get the initial state\n        appState: appState === null ? reducer(null) : appState,\n\n        // Deprecated\n        displayMenuButton: false,\n      },\n    },\n    children\n  )\n}\n\nfunction getAragonApiData(hookName) {\n  const aragonApiData = useContext(AragonApiContext)\n\n  if (aragonApiData === undefined) {\n    throw new Error(\n      `You used ${hookName} in a component that is not a descendant of ` +\n        '<AragonApi />. Please declare this component (in the top ' +\n        'level component of your app for example).'\n    )\n  }\n\n  return aragonApiData\n}\n\nconst useAragonApi = () => ({\n  ...getAragonApiData('useAragonApi()'),\n  _sendMessage: postMessage,\n\n  // Deprecated\n  requestMenu,\n})\n\n// direct access hooks\nconst useApi = () => getAragonApiData('useApi()').api\nconst useAppState = () => getAragonApiData('useAppState()').appState\nconst useConnectedAccount = () =>\n  getAragonApiData('useConnectedAccount()').connectedAccount\nconst useCurrentApp = () => getAragonApiData('useCurrentApp()').currentApp\nconst useInstalledApps = () => getAragonApiData('useInstalledApps()').installedApps\nconst useNetwork = () => getAragonApiData('useNetwork()').network\nconst usePath = () => {\n  const { path, requestPath } = getAragonApiData('usePath()')\n  return [path, requestPath]\n}\nfunction useGuiStyle() {\n  return getAragonApiData('useGuiStyle()').guiStyle\n}\n\n// Deprecated\nconst useMenuButton = () => {\n  warn('api-react: \"useMenuButton\" is deprecated. It can safely be removed from your codebase.')\n\n  return [\n    getAragonApiData('useMenuButton()').displayMenuButton,\n    requestMenu,\n  ]\n}\n\nexport {\n  AragonApi,\n  AragonApiContext as _AragonApiContext,\n  useApi,\n  useAppState,\n  useAragonApi,\n  useConnectedAccount,\n  useCurrentApp,\n  useInstalledApps,\n  useNetwork,\n  usePath,\n  useGuiStyle,\n  // Deprecated\n  useMenuButton,\n}\n"],"file":"index.js"}