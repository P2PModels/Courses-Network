{"version":3,"sources":["../src/index.test.js"],"names":["Index","proxyquire","noCallThru","load","sleep","time","Promise","resolve","setTimeout","createDeferredStub","observable","sinon","stub","returns","subscribe","handler","test","afterEach","always","restore","t","plan","id","result","instanceStub","rpc","sendAndObserveResponse","AppProxyHandler","get","value","is","true","calledOnceWith","networkDetails","type","networkFn","AppProxy","prototype","network","jsonrpc","sendAndObserveResponses","call","deepEqual","truthy","accountsFn","accounts","currentApp","abi","appAddress","appId","appImplementationAddress","identifier","isForwarder","kernelAddress","name","roles","currentAppFn","icon","initialApps","endApps","concat","installedAppsFn","installedApps","emitIndex","forEach","app","fail","identifyFn","identify","send","pathFn","path","requestPathFn","requestPath","eventData","testprop","emitTriggerFn","emitTrigger","triggersFn","triggers","eventsFn","events","externalFn","external","observableEvents","jsonInterfaceStub","eventsObservable","fromBlock","observableCall","constant","callResult","grantPermission","observableIntent","intentResult","add","stateFn","state","stateObservable","Subject","counter","next","storeFn","store","cache","getCache","pastEvents","web3Eth","withArgs","action","actionHistory","event","push","payload","blockNumber","callFn","describeScriptFn","describeScript","web3EthFn"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport proxyquire from 'proxyquire'\nimport { defer, from, of, Subject } from 'rxjs'\n\nconst Index = proxyquire.noCallThru().load('./index', {\n  '@aragon/rpc-messenger': {}\n})\n\nasync function sleep (time) {\n  return new Promise(resolve => setTimeout(resolve, time))\n}\n\nfunction createDeferredStub (observable) {\n  return sinon.stub().returns(defer(() => observable))\n}\n\nfunction subscribe (observable, handler) {\n  // Mimic an async delay to test the deferred behaviour\n  sleep(10)\n  observable.subscribe(handler)\n}\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should send intent when the method does not exist in target', t => {\n  t.plan(2)\n  // arrange\n  const observable = of({\n    id: 'uuid1',\n    result: 10\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = Index.AppProxyHandler.get(instanceStub, 'add')(5)\n  // assert\n  subscribe(result, value => {\n    t.is(value, 10)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('intent', ['add', 5]))\n})\n\ntest('should return the network details as an observable', t => {\n  t.plan(2)\n  // arrange\n  const networkDetails = {\n    id: 4,\n    type: 'rinkeby'\n  }\n  const networkFn = Index.AppProxy.prototype.network\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: networkDetails\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = networkFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, networkDetails)\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('network'))\n})\n\ntest('should return the accounts as an observable', t => {\n  t.plan(2)\n  // arrange\n  const accountsFn = Index.AppProxy.prototype.accounts\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: ['accountX', 'accountY', 'accountZ']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = accountsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountX', 'accountY', 'accountZ'])\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('accounts'))\n})\n\ntest('should send a getApps request for the current app and observe the single response', t => {\n  t.plan(3)\n\n  const currentApp = {\n    abi: 'abi for counter',\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter',\n    roles: 'roles for counter'\n  }\n\n  // arrange\n  const currentAppFn = Index.AppProxy.prototype.currentApp\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: currentApp\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = currentAppFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.is(value.icon(), undefined)\n    delete value.icon\n\n    t.deepEqual(value, currentApp)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('get_apps'))\n})\n\ntest('should send a getApps request for installed apps and observe the response', t => {\n  const initialApps = [{\n    abi: 'abi for kernel',\n    appAddress: '0x123',\n    appId: 'kernel',\n    appImplementationAddress: '0xkernel',\n    identifier: undefined,\n    isForwarder: false,\n    kernelAddress: undefined,\n    name: 'Kernel',\n    roles: 'roles for kernel'\n  }]\n  const endApps = [].concat(initialApps, {\n    abi: 'abi for counter',\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter',\n    roles: 'roles for counter'\n  })\n\n  // arrange\n  const installedAppsFn = Index.AppProxy.prototype.installedApps\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: initialApps\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: endApps\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = installedAppsFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    value.forEach(app => {\n      t.is(app.icon(), undefined)\n      delete app.icon\n    })\n\n    if (emitIndex === 0) {\n      t.deepEqual(value, initialApps)\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, endApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('get_apps'))\n})\n\ntest('should send an identify request', t => {\n  t.plan(1)\n  // arrange\n  const identifyFn = Index.AppProxy.prototype.identify\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  identifyFn.call(instanceStub, 'ANT')\n  // assert\n  t.true(instanceStub.rpc.send.calledOnceWith('identify', ['ANT']))\n})\n\ntest('should send a path request and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const pathFn = Index.AppProxy.prototype.path\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path1'\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path2'\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = pathFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, 'path1')\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, 'path2')\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('path', ['observe']))\n})\n\ntest('should send a path modification request', t => {\n  t.plan(2)\n  // arrange\n  const path = 'new_path'\n  const requestPathFn = Index.AppProxy.prototype.requestPath\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: null\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = requestPathFn.call(instanceStub, path)\n  // assert\n  subscribe(result, value => t.is(value, null))\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('path', ['modify', path]))\n})\n\ntest('should send a trigger emission', t => {\n  t.plan(1)\n  // arrange\n  const eventName = 'TestTrigger'\n  const eventData = { testprop: '123abc' }\n  const emitTriggerFn = Index.AppProxy.prototype.emitTrigger\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  emitTriggerFn.call(instanceStub, eventName, eventData)\n  // assert\n  t.true(instanceStub.rpc.send.calledOnceWith('trigger', ['emit', eventName, eventData]))\n})\n\ntest('should return the triggers observable', t => {\n  t.plan(2)\n  // arrange\n  const triggersFn = Index.AppProxy.prototype.triggers\n  // TODO\n  const observable = of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = triggersFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    // TODO\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('trigger', ['observe']))\n})\n\ntest('should return the events observable', t => {\n  t.plan(2)\n  // arrange\n  const eventsFn = Index.AppProxy.prototype.events\n  const observable = of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = eventsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('events', ['allEvents', {}]))\n})\n\ntest('should return an handle for an external contract events', t => {\n  t.plan(2)\n  const fromBlock = 2\n\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableEvents = of({\n    id: 'uuid1',\n    result: { name: 'eventA', value: 3000 }\n  })\n  const jsonInterfaceStub = [\n    { type: 'event', name: 'SetPermission' }\n  ]\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observableEvents)\n    }\n  }\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  // events from starting block\n  const eventsObservable = result.events({ fromBlock })\n  // assert\n  subscribe(eventsObservable, value => {\n    t.deepEqual(value, { name: 'eventA', value: 3000 })\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponses.calledOnceWith(\n      'external_events',\n      ['0xextContract', [jsonInterfaceStub[0]], 'allEvents', { fromBlock }]\n    )\n  )\n})\n\ntest('should return a handle for creating external calls', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableCall = of({\n    id: 'uuid4',\n    result: 'bob was granted permission for the counter app'\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'grantPermission', constant: true }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableCall)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const callResult = result.grantPermission('0xbob', '0xcounter')\n\n  // assert\n  subscribe(callResult, value => {\n    t.is(value, 'bob was granted permission for the counter app')\n  })\n\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_call',\n      ['0xextContract', jsonInterfaceStub[0], '0xbob', '0xcounter']\n    )\n  )\n})\n\ntest('should return a handle for creating external transaction intents', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableIntent = of({\n    id: 'uuid4',\n    result: 10\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'add', constant: false }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableIntent)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const intentResult = result.add(10)\n\n  // assert\n  subscribe(intentResult, value => {\n    t.is(value, 10)\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_intent',\n      ['0xextContract', jsonInterfaceStub[0], 10]\n    )\n  )\n})\n\ntest('should return the state from cache', t => {\n  t.plan(3)\n  // arrange\n  const stateFn = Index.AppProxy.prototype.state\n  const stateObservable = new Subject()\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(stateObservable)\n    }\n  }\n  // act\n  const result = stateFn.call(instanceStub)\n  // assert\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('cache', ['observe', 'state']))\n\n  let counter = 0\n  subscribe(result, value => {\n    if (counter === 0) {\n      t.deepEqual(value, { counter: 5 })\n    } else if (counter === 1) {\n      t.deepEqual(value, { counter: 6 })\n    }\n    counter++\n  })\n  // send state events\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 5 }\n  })\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 6 }\n  })\n})\n\ntest('should create a store and reduce correctly without previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => from([null]),\n    pastEvents: () => of([]),\n    triggers: () => of(),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 2) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 12) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(1200)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(1200)\n})\n\ntest('should create a store and reduce correctly with previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => of({\n      state: {\n        actionHistory: [\n          { event: 'Add', payload: 5 }\n        ],\n        counter: 5\n      },\n      blockNumber: 1\n    }),\n    pastEvents: () => of([]),\n    triggers: () => of(),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 5) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 }\n      ])\n    }\n    if (value.counter === 7) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 17) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(1200)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(1200)\n})\n\ntest('should perform a call to the contract and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const callFn = Index.AppProxy.prototype.call\n  const observable = of({\n    id: 'uuid1',\n    result: 'success'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = callFn.call(instanceStub, 'transferEth', 10)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'success')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('call', ['transferEth', 10]))\n})\n\ntest('should send a describeScript request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const describeScriptFn = Index.AppProxy.prototype.describeScript\n  const observable = of({\n    id: 'uuid1',\n    result: 'script executed'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = describeScriptFn.call(instanceStub, 'goto fail')\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'script executed')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('describe_script', ['goto fail']))\n})\n\ntest('should send a web3Eth function request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const web3EthFn = Index.AppProxy.prototype.web3Eth\n  const observable = of({\n    id: 'uuid1',\n    result: ['accountA', 'accountB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = web3EthFn.call(instanceStub, 'getAccounts', 5)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountA', 'accountB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('web3_eth', ['getAccounts', 5]))\n})\n"],"file":"index.test.js"}